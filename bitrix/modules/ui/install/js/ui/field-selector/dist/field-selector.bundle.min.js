this.BX=this.BX||{};(function(e,t,s,i){"use strict";class l{static isValid(e){return e===l.INTEGER||e===l.STRING}}l.INTEGER="int";l.STRING="string";var a=babelHelpers.classPrivateFieldLooseKey("values");class r{constructor(){Object.defineProperty(this,a,{writable:true,value:[]});this.clear()}clear(){babelHelpers.classPrivateFieldLooseBase(this,a)[a]=[]}set(e){babelHelpers.classPrivateFieldLooseBase(this,a)[a]=this.prepare(e)}get(){return babelHelpers.classPrivateFieldLooseBase(this,a)[a]}prepare(e){const t=[];e.forEach((e=>{var s,l;if(!i.Type.isArray(e)||e.length!==2){return}if(!this.validateEntityId((s=e[0])!=null?s:null)){return}if(!this.validateValue((l=e[1])!=null?l:null)){return}t.push(e)}));return t}validateEntityId(e){return i.Type.isStringFilled(e)}validateValue(e){return false}}class o extends r{validateValue(e){return i.Type.isInteger(e)&&e>0}}class n extends r{validateValue(e){return i.Type.isString(e)&&e.length>0}}let c=e=>e,d,b,h,u,p;var v=babelHelpers.classPrivateFieldLooseKey("state");var g=babelHelpers.classPrivateFieldLooseKey("containerId");var y=babelHelpers.classPrivateFieldLooseKey("fieldName");var F=babelHelpers.classPrivateFieldLooseKey("multiple");var P=babelHelpers.classPrivateFieldLooseKey("valueCollection");var S=babelHelpers.classPrivateFieldLooseKey("context");var T=babelHelpers.classPrivateFieldLooseKey("entities");var I=babelHelpers.classPrivateFieldLooseKey("searchMessages");var f=babelHelpers.classPrivateFieldLooseKey("changeEvents");class m{constructor(e){Object.defineProperty(this,v,{writable:true,value:true});Object.defineProperty(this,g,{writable:true,value:""});Object.defineProperty(this,y,{writable:true,value:""});Object.defineProperty(this,F,{writable:true,value:false});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,S,{writable:true,value:null});Object.defineProperty(this,T,{writable:true,value:[]});Object.defineProperty(this,I,{writable:true,value:{}});Object.defineProperty(this,f,{writable:true,value:[]});const t=i.Type.isPlainObject(e)?e:{};this.initState();this.setContainerId(t.containerId);this.setFieldName(t.fieldName);this.setMultiple(t.multiple);this.setContext(t.context);this.setEntities(t.entities);this.initValueCollection(t.collectionType);if(!this.isStateSuccess()){return}this.setValues(i.Type.isArray(t.selectedItems)?t.selectedItems:[t.selectedItems]);this.setSearchMessages(t.searchMessages);this.setChangeEvents(t.changeEvents)}initState(){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=true}isStateSuccess(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}showError(e){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=false;if(i.Type.isStringFilled(e)){console.error(`BX.UI.FieldSelector: ${e}`)}}setContainerId(e){babelHelpers.classPrivateFieldLooseBase(this,g)[g]=i.Type.isStringFilled(e)?e:"";if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]===""){this.showError("containerId is empty. Selector is can't be used")}}getContainerId(){return babelHelpers.classPrivateFieldLooseBase(this,g)[g]}setFieldName(e){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=i.Type.isStringFilled(e)?e:"";if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]===""){this.showError("fieldName is empty. Selector is can't be used")}}getFieldName(){return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}setMultiple(e){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=i.Type.isBoolean(e)?e:false}getMultiple(){return babelHelpers.classPrivateFieldLooseBase(this,F)[F]}getTagSelectorContainerId(){return`${this.getContainerId()}_selector`}getTagResultContainerId(){return`${this.getContainerId()}_results`}getTagSelectorControlId(){return`${this.getContainerId()}Control`}initValueCollection(e){if(!l.isValid(e)){this.showError("Unknown value collection type. Selector is can't be used");return}switch(e){case l.STRING:babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new n;break;case l.INTEGER:babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new o;break;default:break}}setValues(e){babelHelpers.classPrivateFieldLooseBase(this,P)[P].set(e)}getValues(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P].get()}setContext(e){babelHelpers.classPrivateFieldLooseBase(this,S)[S]=e}getContext(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,S)[S])!=null?e:null}setEntities(e){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=[];if(!i.Type.isArrayFilled(e)){this.showError("Entity list is empty. Selector is can't be used");return}babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e}getEntities(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T]}setSearchMessages(e){if(i.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,I)[I].title=i.Type.isStringFilled(e.title)?e.title:"";babelHelpers.classPrivateFieldLooseBase(this,I)[I].subtitle=i.Type.isStringFilled(e.subtitle)?e.subtitle:""}else{babelHelpers.classPrivateFieldLooseBase(this,I)[I].title="";babelHelpers.classPrivateFieldLooseBase(this,I)[I].subtitle=""}}getSearchTabTitle(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I].title}getSearchSubtitle(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I].subtitle}setChangeEvents(e){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=[];if(i.Type.isArrayFilled(e)){e.forEach((e=>{if(i.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,f)[f].push(e)}}))}}getChangeEvents(){return babelHelpers.classPrivateFieldLooseBase(this,f)[f]}render(){if(!this.isStateSuccess()){return}const e=this.getContainerId();const t=document.getElementById(e);if(!i.Type.isElementNode(t)){this.showError(`dom-container ${e} is absent. Selector is can't be used`);return}const l=i.Tag.render(d||(d=c`
			<div id="${0}"></div>
		`),this.getTagSelectorContainerId());i.Dom.append(l,t);const a=i.Tag.render(b||(b=c`
			<div id="${0}"></div>
		`),this.getTagResultContainerId());i.Dom.append(a,t);this.renderSelectedItems(this.getValues());const r={id:this.getTagSelectorControlId(),multiple:this.getMultiple(),dialogOptions:{id:this.getTagSelectorControlId(),context:this.getContext(),multiple:this.getMultiple(),preselectedItems:this.getValues(),entities:this.getEntities(),searchOptions:{allowCreateItem:false},searchTabOptions:{stub:true,stubOptions:{title:i.Text.encode(this.getSearchTabTitle()),subtitle:i.Text.encode(this.getSearchSubtitle()),arrow:false}},events:{"Item:onSelect":this.updateSelectedItems.bind(this),"Item:onDeselect":this.updateSelectedItems.bind(this)}}};const o=new s.TagSelector(r);o.renderTo(l)}renderSelectedItems(e){const t=document.getElementById(this.getTagResultContainerId());if(!i.Type.isDomNode(t)){return}const s=this.getFieldName();t.innerHTML="";if(e.length>0){e.forEach((e=>{const l=i.Tag.render(h||(h=c`
					<input type="hidden" name="${0}" value="${0}">
				`),s,i.Tag.safe(u||(u=c`${0}`),e[1].toString()));i.Dom.append(l,t)}))}else{const e=i.Tag.render(p||(p=c`
				<input type="hidden" name="${0}" value="">
			`),s);i.Dom.append(e,t)}}updateSelectedItems(e){const s=e.getTarget();if(!s.isMultiple()){s.hide()}const l=s.getSelectedItems();if(i.Type.isArray(l)){const e=[];l.forEach((t=>{e.push([t.getEntityId(),t.getId()])}));this.setValues(e);this.renderSelectedItems(e);const s=this.getChangeEvents();s.forEach((e=>{t.EventEmitter.emit(e)}))}}}e.FieldSelector=m})(this.BX.UI=this.BX.UI||{},BX.Event,BX.UI.EntitySelector,BX);
//# sourceMappingURL=field-selector.bundle.map.js